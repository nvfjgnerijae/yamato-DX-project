<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link type="text/css" rel="stylesheet" href="resources/sheet.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
/* ========================================
   流動票 スリム化CSS
   ======================================== */
.ritz .waffle a { color: inherit; }

/* ベーススタイル（全セル共通） */
.ritz .waffle td {
  background-color: #fff;
  color: #000;
  font-family: Arial;
  font-size: 8pt;
  vertical-align: middle;
  white-space: nowrap;
  direction: ltr;
  padding: 0 3px;
}

/* text-align バリエーション */
.ritz .waffle .s0,.ritz .waffle .s5,.ritz .waffle .s7,.ritz .waffle .s8,.ritz .waffle .s9,.ritz .waffle .s10,
.ritz .waffle .s11,.ritz .waffle .s13,.ritz .waffle .s16,.ritz .waffle .s17,.ritz .waffle .s18,.ritz .waffle .s19,
.ritz .waffle .s21,.ritz .waffle .s22,.ritz .waffle .s25,.ritz .waffle .s28,.ritz .waffle .s31,.ritz .waffle .s32,
.ritz .waffle .s33,.ritz .waffle .s36,.ritz .waffle .s43,.ritz .waffle .s44,.ritz .waffle .s45,
.ritz .waffle .s46,.ritz .waffle .s48,.ritz .waffle .s49,.ritz .waffle .s52,.ritz .waffle .s53,.ritz .waffle .s54,
.ritz .waffle .s55,.ritz .waffle .s56,.ritz .waffle .s57,
.ritz .waffle .s58 {
  text-align: center;
}

.ritz .waffle .s1,
.ritz .waffle .s4,
.ritz .waffle .s6,
.ritz .waffle .s12,
.ritz .waffle .s14,
.ritz .waffle .s15,
.ritz .waffle .s20,
.ritz .waffle .s23,
.ritz .waffle .s24,
.ritz .waffle .s26,
.ritz .waffle .s29,
.ritz .waffle .s30,
.ritz .waffle .s35,
.ritz .waffle .s37,
.ritz .waffle .s38,
.ritz .waffle .s39,
.ritz .waffle .s40,
.ritz .waffle .s42,
.ritz .waffle .s47,
.ritz .waffle .s50,
.ritz .waffle .s51 {
  text-align: left;
}

.ritz .waffle .s3,
.ritz .waffle .s19 {
  text-align: right;
}

/* border パターン - 下線2px */
.ritz .waffle .s4,
.ritz .waffle .s5,
.ritz .waffle .s6,
.ritz .waffle .s7,
.ritz .waffle .s24,
.ritz .waffle .s25,
.ritz .waffle .s26,
.ritz .waffle .s30,
.ritz .waffle .s33,
.ritz .waffle .s46,
.ritz .waffle .s47,
.ritz .waffle .s48,
.ritz .waffle .s49,
.ritz .waffle .s50,
.ritz .waffle .s51,
.ritz .waffle .s52,
.ritz .waffle .s53,
.ritz .waffle .s54,
.ritz .waffle .s57 {
  border-bottom: 2px solid #000;
}

/* 下線1px */
.ritz .waffle .s10,
.ritz .waffle .s11,
.ritz .waffle .s12,
.ritz .waffle .s13,
.ritz .waffle .s14,
.ritz .waffle .s15,
.ritz .waffle .s16,
.ritz .waffle .s17,
.ritz .waffle .s18,
.ritz .waffle .s19,
.ritz .waffle .s20,
.ritz .waffle .s21,
.ritz .waffle .s22,
.ritz .waffle .s23,
.ritz .waffle .s28,
.ritz .waffle .s31,
.ritz .waffle .s32,
.ritz .waffle .s34,
.ritz .waffle .s35,
.ritz .waffle .s40,
.ritz .waffle .s41,
.ritz .waffle .s42,
.ritz .waffle .s56,
.ritz .waffle .s58 {
  border-bottom: 1px solid #000;
}

/* 右線2px */
.ritz .waffle .s8,
.ritz .waffle .s11,
.ritz .waffle .s13,
.ritz .waffle .s14,
.ritz .waffle .s21,
.ritz .waffle .s26,
.ritz .waffle .s27,
.ritz .waffle .s34,
.ritz .waffle .s39,
.ritz .waffle .s42,
.ritz .waffle .s45,
.ritz .waffle .s53,
.ritz .waffle .s54,
.ritz .waffle .s58 {
  border-right: 2px solid #000;
}

/* 右線1px */
.ritz .waffle .s9,
.ritz .waffle .s10,
.ritz .waffle .s12,
.ritz .waffle .s15,
.ritz .waffle .s16,
.ritz .waffle .s17,
.ritz .waffle .s18,
.ritz .waffle .s19,
.ritz .waffle .s20,
.ritz .waffle .s22,
.ritz .waffle .s23,
.ritz .waffle .s24,
.ritz .waffle .s25,
.ritz .waffle .s28,
.ritz .waffle .s31,
.ritz .waffle .s32,
.ritz .waffle .s33,
.ritz .waffle .s35,
.ritz .waffle .s43,
.ritz .waffle .s44,
.ritz .waffle .s46,
.ritz .waffle .s47,
.ritz .waffle .s48,
.ritz .waffle .s50,
.ritz .waffle .s51,
.ritz .waffle .s52,
.ritz .waffle .s55,
.ritz .waffle .s56,
.ritz .waffle .s57 {
  border-right: 1px solid #000;
}

/* 背景色グレー */
.ritz .waffle .s13,
.ritz .waffle .s15,
.ritz .waffle .s22,
.ritz .waffle .s26,
.ritz .waffle .s55 {
  background-color: #d9d9d9;
}

/* font-size バリエーション */
.ritz .waffle .s2 {
  font-size: 22pt;
  font-weight: 700;
}

.ritz .waffle .s7,
.ritz .waffle .s21,
.ritz .waffle .s25,
.ritz .waffle .s32 {
  font-size: 9pt;
}

.ritz .waffle .s17,
.ritz .waffle .s44,
.ritz .waffle .s45,
.ritz .waffle .s48 {
  font-size: 10pt;
}

.ritz .waffle .s28,
.ritz .waffle .s35,
.ritz .waffle .s36,
.ritz .waffle .s37,
.ritz .waffle .s38,
.ritz .waffle .s39,
.ritz .waffle .s40,
.ritz .waffle .s42,
.ritz .waffle .s46,
.ritz .waffle .s47,
.ritz .waffle .s50,
.ritz .waffle .s51 {
  font-size: 11pt;
}

.ritz .waffle .s52,
.ritz .waffle .s53 {
  font-size: 14pt;
}

.ritz .waffle .s18,
.ritz .waffle .s31,
.ritz .waffle .s56,
.ritz .waffle .s57,
.ritz .waffle .s58 {
  font-size: 7pt;
}

.ritz .waffle .s29,
.ritz .waffle .s30 {
  font-size: 10pt;
}

/* font-weight: bold */
.ritz .waffle .s2,
.ritz .waffle .s7,
.ritz .waffle .s17,
.ritz .waffle .s21,
.ritz .waffle .s25,
.ritz .waffle .s38,
.ritz .waffle .s52,
.ritz .waffle .s53 {
  font-weight: 700;
}

/* font-family 特殊 */
.ritz .waffle .s15,
.ritz .waffle .s23,
.ritz .waffle .s37,
.ritz .waffle .s39,
.ritz .waffle .s42 {
  font-family: "docs-Aptos Narrow", Arial;
}

/* 折り返し許可 */
.ritz .waffle .s16,
.ritz .waffle .s17,
.ritz .waffle .s18,
.ritz .waffle .s20,
.ritz .waffle .s21 {
  white-space: normal;
  overflow: hidden;
  word-wrap: break-word;
}

/* 縦書きセル */
.ritz .waffle .s9 {
  line-height: 1.4;
  padding: 2px 3px;
  border-bottom: 2px solid #000; /* ← この行を追加 */
}

/* 特殊クラス */
.ritz .waffle .s27 {
  background-color: #fff;
}

.ritz .waffle .s41 {
  border-bottom: 1px solid #000;
  background-color: #fff;
}

.ritz .waffle .s59 {
  width: 0;
  padding: 0;
  margin: 0;
  overflow: hidden;
}

/* 入力セル */
td[contenteditable="true"] { outline: none; }
td[contenteditable="true"]:focus { box-shadow: inset 0 0 0 1px #4c9aff; }

/* ヘッダー行 */
thead, th.row-headers-background {
  display: table-header-group;
  height: 0;
  line-height: 0;
  font-size: 0;
  overflow: hidden;
  visibility: hidden;
}

/* テーブルレイアウト */
.ritz .waffle { table-layout: fixed; }
.ritz .waffle td { overflow: hidden; text-overflow: ellipsis; }
.ritz .waffle td.wrap-cell {
  white-space: normal !important;
  overflow: visible !important;
  text-overflow: clip !important;
  word-break: break-all;
}

/* 印刷用 */
@media print {
  #control-panel { display: none; }
  body { margin: 0; }
  .waffle { zoom: 1.00; }
  html, body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  .ritz .waffle .s13,
  .ritz .waffle .s15,
  .ritz .waffle .s22,
  .ritz .waffle .s26,
  .ritz .waffle .s55 {
    background-color: #d9d9d9 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
}
</style>
<div id="control-panel" style="margin-bottom: 1rem;">
  <textarea id="json-input" rows="10" style="width:100%;"
  placeholder=
'```json
{
  "基本情報":
}
```
```json
{
  "工程管理記入欄": 
}
```
  '></textarea>
  <div style="margin-top: 0.5rem; display:flex; gap:0.5rem; flex-wrap:wrap;">
  <button id="apply-json-btn">情報を反映</button>
  <button id="print-btn">保存/印刷</button>
</div>
</div>
<div class="ritz grid-container" dir="ltr">
<table class="waffle" cellspacing="0" cellpadding="0">
<thead>
<tr>
<th class="row-header freezebar-origin-ltr"></th>
<th id="942883767C0" style="width:0px" class="column-headers-background">A</th>
<th id="942883767C1" style="width:34px" class="column-headers-background">B</th>
<th id="942883767C2" style="width:28px" class="column-headers-background">C</th>
<th id="942883767C3" style="width:29px" class="column-headers-background">D</th>
<th id="942883767C4" style="width:34px" class="column-headers-background">E</th>
<th id="942883767C5" style="width:36px" class="column-headers-background">F</th>
<th id="942883767C6" style="width:21px" class="column-headers-background">G</th>
<th id="942883767C7" style="width:6px" class="column-headers-background">H</th>
<th id="942883767C8" style="width:36px" class="column-headers-background">I</th>
<th id="942883767C9" style="width:30px" class="column-headers-background">J</th>
<th id="942883767C10" style="width:47px" class="column-headers-background">K</th>
<th id="942883767C11" style="width:24px" class="column-headers-background">L</th>
<th id="942883767C12" style="width:33px" class="column-headers-background">M</th>
<th id="942883767C13" style="width:45px" class="column-headers-background">N</th>
<th id="942883767C14" style="width:21px" class="column-headers-background">O</th>
<th id="942883767C15" style="width:45px" class="column-headers-background">P</th>
<th id="942883767C16" style="width:76px" class="column-headers-background">Q</th>
<th id="942883767C17" style="width:61px" class="column-headers-background">R</th>
<th id="942883767C18" style="width:39px" class="column-headers-background">S</th>
<th id="942883767C19" style="width:46px" class="column-headers-background">T</th>
</tr>
</thead>
<tbody>
<tr style="height:23px">
<th id="942883767R0" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">1</div></th>
<td class="s60"></td>
<td class="s60" dir="ltr"></td>
<td class="s60"></td>
<td class="s60"></td>
<td class="s60"></td>
<td class="s60"></td>
<td class="s60"></td>
<td class="s60"></td>
<td class="s60"></td>
<td class="s60"></td>
<td class="s60"></td>
<td class="s60"></td>
<td class="s60"></td>
<td class="s60"></td>
<td class="s60"></td>
<td class="s60"></td>
<td class="s60"></td>
<td class="s60"></td>
</tr>
<tr style="height:23px">
<th id="942883767R1" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">2</div></th>
<td class="s0"></td>
<td class="s1" colspan="2">様式-1</td>
<td class="s1"></td>
<td class="s1"></td>
<td class="s1"></td>
<td class="s1"></td>
<td class="s1"></td>
<td class="s2" dir="ltr"></td>
<td class="s2" dir="ltr" colspan="5" rowspan="2">流　動　票</td>
<td class="s2"></td>
<td class="s2"></td>
<td class="s3" colspan="2">大和電機工業株式会社</td>
</tr>
<tr style="height:23px">
<th id="942883767R2" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">3</div></th>
<td class="s1"></td>
<td class="s1">発行日</td>
<td class="s1" dir="ltr" colspan="3"></td>
<td class="s1"></td>
<td class="s1"></td>
<td class="s1"></td>
<td class="s2" dir="ltr"></td>
<td class="s2"></td>
<td class="s2"></td>
<td class="s2"></td>
<td class="s3">特機事業所</td>
</tr>
<tr style="height:23px">
<th id="942883767R3" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">4</div></th>
<td class="s1"></td>
<td class="s4" dir="ltr">Rev.H</td>
<td class="s4"></td>
<td class="s4"></td>
<td class="s4"></td>
<td class="s4"></td>
<td class="s4" colspan="3">依頼主</td>
<td class="s5" colspan="5"></td>
<td class="s5"></td>
<td class="s6" dir="ltr">No.</td>
<td class="s7" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R4" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">5</div></th>
<td class="s8"></td>
<td class="s9" rowspan="16">管<br>理<br>部<br>門<br>記<br>入<br>欄</td>
<td class="s10" colspan="6">会社名</td>
<td class="s10" dir="ltr" colspan="6">製品名</td>
<td class="s10" dir="ltr" colspan="3">図面番号</td>
<td class="s11">発送日</td>
</tr>
<tr style="height:23px">
<th id="942883767R5" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">6</div></th>
<td class="s8"></td>
<td class="s12" dir="ltr" colspan="6"></td>
<td class="s12" dir="ltr" colspan="6"></td>
<td class="s12" dir="ltr" colspan="3"></td>
<td class="s11" dir="ltr"></td>
</tr>
<tr style="height:23px">
<th id="942883767R6" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">7</div></th>
<td class="s8"></td>
<td class="s10" dir="ltr" colspan="2">分納納期１</td>
<td class="s10" dir="ltr" colspan="2"></td>
<td class="s10" dir="ltr" colspan="3"></td>
<td class="s10" dir="ltr" colspan="2">分納納期２</td>
<td class="s10" dir="ltr" colspan="2"></td>
<td class="s10" dir="ltr" colspan="2"></td>
<td class="s13" dir="ltr" colspan="3"></td>
</tr>
<tr style="height:23px">
<th id="942883767R7" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">8</div></th>
<td class="s8"></td>
<td class="s10" colspan="2">材質</td>
<td class="s12" dir="ltr" colspan="6"></td>
<td class="s10">フライス</td>
<td class="s12" dir="ltr" colspan="2"></td>
<td class="s10" colspan="2">購入先</td>
<td class="s14" dir="ltr" colspan="3"></td>
</tr>
<tr style="height:23px">
<th id="942883767R8" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">9</div></th>
<td class="s8"></td>
<td class="s10" colspan="2">材料寸法</td>
<td class="s10">縦</td>
<td class="s10" dir="ltr" colspan="3"></td>
<td class="s10">横</td>
<td class="s10" dir="ltr" colspan="2"></td>
<td class="s10">高</td>
<td class="s10" dir="ltr" colspan="3"></td>
<td class="s10" colspan="1">個数</td>
<td class="s10" dir="ltr">材料価格</td>
<td class="s14" dir="ltr"></td>
</tr>
<tr style="height:23px">
<th id="942883767R9" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">10</div></th>
<td class="s8"></td>
<td class="s16" dir="ltr" colspan="3">新規/リピート</td>
<td class="s17" dir="ltr" colspan="4"></td>
<td class="s18" dir="ltr" colspan="2">製造/設計/転売</td>
<td class="s17" dir="ltr" colspan="2"></td>
<td class="s55" dir="ltr" colspan="2" rowspan="3"></td>
<td class="s19" dir="ltr" colspan="1"></td>
<td class="s10" dir="ltr">外注価格</td>
<td class="s14" dir="ltr"></td>
</tr>
<tr style="height:23px">
<th id="942883767R10" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">11</div></th>
<td class="s8"></td>
<td class="s10" colspan="2">業者1</td>
<td class="s20" dir="ltr" colspan="5"></td>
<td class="s18">役割</td>
<td class="s20" dir="ltr" colspan="3"></td>
<td class="s10" dir="ltr" colspan="1">注文数</td>
<td class="s10" dir="ltr">販売単価</td>
<td class="s14" dir="ltr"></td>
</tr>
<tr style="height:23px">
<th id="942883767R11" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">12</div></th>
<td class="s8"></td>
<td class="s10" colspan="2">業者2</td>
<td class="s20" dir="ltr" colspan="5"></td>
<td class="s18">役割</td>
<td class="s20" dir="ltr" colspan="3"></td>
<td class="s19" colspan="1"></td>
<td class="s10" dir="ltr" rowspan="2">作成者</td>
<td class="s21" dir="ltr" rowspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R12" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">13</div></th>
<td class="s8"></td>
<td class="s10" colspan="2">業者3</td>
<td class="s20" dir="ltr" colspan="5"></td>
<td class="s18">役割</td>
<td class="s20" dir="ltr" colspan="3"></td>
<td class="s22" colspan="3" rowspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R13" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">14</div></th>
<td class="s8"></td>
<td class="s10" colspan="2">業者4</td>
<td class="s20" colspan="5"></td>
<td class="s18">役割</td>
<td class="s20" colspan="3"></td>
<td class="s13" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R14" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">15</div></th>
<td class="s8"></td>
<td class="s11" colspan="16">工程の注意点</td>
</tr>
<tr style="height:23px">
<th id="942883767R15" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">16</div></th>
<td class="s8"></td>
<td class="s14" dir="ltr" colspan="16" rowspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R16" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">17</div></th>
<td class="s8"></td>
</tr>
<tr style="height:23px">
<th id="942883767R17" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">18</div></th>
<td class="s8"></td>
<td class="s10" colspan="4">図面問い合わせ内容：</td>
<td class="s14" colspan="12"></td>
</tr>
<tr style="height:23px">
<th id="942883767R18" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">19</div></th>
<td class="s8"></td>
<td class="s10" colspan="4">回答：</td>
<td class="s14" colspan="12"></td>
</tr>
<tr style="height:23px">
<th id="942883767R19" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">20</div></th>
<td class="s8"></td>
<td class="s24" dir="ltr"colspan="2">処理の有無</td>
<td class="s25" dir="ltr"></td>
<td class="s24" dir="ltr">台待ち</td>
<td class="s33" dir="ltr" colspan="2"></td>
<td class="s33" dir="ltr">いつ</td>
<td class="s33" dir="ltr" colspan="2"></td>
<td class="s33" dir="ltr">誰が</td>
<td class="s24" dir="ltr" colspan="2"></td>
<td class="s33" dir="ltr" colspan="2">誰に確認</td>
<td class="s24" dir="ltr"></td>
<td class="s26" dir="ltr"></td>
</tr>
<tr style="height:23px">
<th id="942883767R20" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">21</div></th>
<td class="s27"></td>
<td class="s9" rowspan="17">工<br>程<br>管<br>理<br>記<br>入<br>欄</td>
<td class="s28" colspan="5" rowspan="2">特別購入品</td>
<td class="s12" dir="ltr" colspan="7"></td>
<td class="s14" dir="ltr" colspan="4"></td>
</tr>
<tr style="height:23px">
<th id="942883767R21" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">22</div></th>
<td class="s27"></td>
<td class="s12" dir="ltr" colspan="7"></td>
<td class="s14" dir="ltr" colspan="4"></td>
<td class="s30"></td>
<td class="s30"></td>
</tr>
<tr style="height:23px">
<th id="942883767R22" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">23</div></th>
<td class="s27"></td>
<td class="s10">月</td>
<td class="s10" dir="ltr">日</td>
<td class="s10" colspan="3">工程記入</td>
<td class="s10" colspan="3">作業時間</td>
<td class="s10" colspan="2">段取時間(分)</td>
<td class="s10" colspan="2">冶工具</td>
<td class="s10" colspan="2">作業時間(分)</td>
<td class="s31" dir="ltr">外注又は加工者名</td>
<td class="s10">単価</td>
<td class="s11" colspan="2">品質確認者</td>
</tr>
<tr style="height:23px">
<th id="942883767R23" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">24</div></th>
<td class="s27"></td>
<td class="s32" dir="ltr"></td>
<td class="s32" dir="ltr"></td>
<td class="s56" dir="ltr" colspan="3"></td>
<td class="s10" dir="ltr" colspan="3"></td>
<td class="s10" dir="ltr" colspan="2"></td>
<td class="s56" dir="ltr" colspan="2"></td>
<td class="s10" dir="ltr" colspan="2"></td>
<td class="s56" dir="ltr"></td>
<td class="s10" dir="ltr"></td>
<td class="s58" dir="ltr" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R24" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">25</div></th>
<td class="s27"></td>
<td class="s32"></td>
<td class="s32"></td>
<td class="s56" dir="ltr" colspan="3"></td>
<td class="s10" dir="ltr" colspan="3"></td>
<td class="s10" colspan="2"></td>
<td class="s56" colspan="2"></td>
<td class="s10" colspan="2"></td>
<td class="s56"></td>
<td class="s10"></td>
<td class="s58" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R25" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">26</div></th>
<td class="s27"></td>
<td class="s32"></td>
<td class="s32"></td>
<td class="s56" colspan="3"></td>
<td class="s10" colspan="3"></td>
<td class="s10" colspan="2"></td>
<td class="s56" colspan="2"></td>
<td class="s10" colspan="2"></td>
<td class="s56"></td>
<td class="s10"></td>
<td class="s58" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R26" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">27</div></th>
<td class="s27"></td>
<td class="s32"></td>
<td class="s32"></td>
<td class="s56" colspan="3"></td>
<td class="s10" colspan="3"></td>
<td class="s10" colspan="2"></td>
<td class="s56" colspan="2"></td>
<td class="s10" colspan="2"></td>
<td class="s56"></td>
<td class="s10"></td>
<td class="s58" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R27" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">28</div></th>
<td class="s27"></td>
<td class="s32"></td>
<td class="s32"></td>
<td class="s56" colspan="3"></td>
<td class="s10" colspan="3"></td>
<td class="s10" colspan="2"></td>
<td class="s56" colspan="2"></td>
<td class="s10" colspan="2"></td>
<td class="s56"></td>
<td class="s10"></td>
<td class="s58" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R28" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">29</div></th>
<td class="s27"></td>
<td class="s32"></td>
<td class="s32"></td>
<td class="s56" colspan="3"></td>
<td class="s10" colspan="3"></td>
<td class="s10" colspan="2"></td>
<td class="s56" colspan="2"></td>
<td class="s10" colspan="2"></td>
<td class="s56"></td>
<td class="s10"></td>
<td class="s58" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R29" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">30</div></th>
<td class="s27"></td>
<td class="s32"></td>
<td class="s32"></td>
<td class="s56" colspan="3"></td>
<td class="s10" colspan="3"></td>
<td class="s10" colspan="2"></td>
<td class="s56" colspan="2"></td>
<td class="s10" colspan="2"></td>
<td class="s56"></td>
<td class="s10"></td>
<td class="s58" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R30" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">31</div></th>
<td class="s27"></td>
<td class="s32"></td>
<td class="s32"></td>
<td class="s56" colspan="3"></td>
<td class="s10" colspan="3"></td>
<td class="s10" colspan="2"></td>
<td class="s56" colspan="2"></td>
<td class="s10" colspan="2"></td>
<td class="s56"></td>
<td class="s10"></td>
<td class="s58" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R31" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">32</div></th>
<td class="s27"></td>
<td class="s32"></td>
<td class="s32"></td>
<td class="s56" colspan="3"></td>
<td class="s10" colspan="3"></td>
<td class="s10" colspan="2"></td>
<td class="s56" colspan="2"></td>
<td class="s10" colspan="2"></td>
<td class="s56"></td>
<td class="s10"></td>
<td class="s58" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R32" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">33</div></th>
<td class="s27"></td>
<td class="s32"></td>
<td class="s32"></td>
<td class="s56" colspan="3"></td>
<td class="s10" colspan="3"></td>
<td class="s10" colspan="2"></td>
<td class="s56" colspan="2"></td>
<td class="s10" colspan="2"></td>
<td class="s56"></td>
<td class="s10"></td>
<td class="s58" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R33" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">34</div></th>
<td class="s27"></td>
<td class="s32"></td>
<td class="s32"></td>
<td class="s56" colspan="3"></td>
<td class="s10" colspan="3"></td>
<td class="s10" colspan="2"></td>
<td class="s56" colspan="2"></td>
<td class="s10" colspan="2"></td>
<td class="s56"></td>
<td class="s10"></td>
<td class="s58" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R34" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">35</div></th>
<td class="s27"></td>
<td class="s32"></td>
<td class="s32"></td>
<td class="s56" colspan="3"></td>
<td class="s10" colspan="3"></td>
<td class="s10" colspan="2"></td>
<td class="s56" colspan="2"></td>
<td class="s10" colspan="2"></td>
<td class="s56"></td>
<td class="s10"></td>
<td class="s58" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R35" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">36</div></th>
<td class="s27"></td>
<td class="s32"></td>
<td class="s32"></td>
<td class="s56" colspan="3"></td>
<td class="s10" colspan="3"></td>
<td class="s10" colspan="2"></td>
<td class="s56" colspan="2"></td>
<td class="s10" colspan="2"></td>
<td class="s56"></td>
<td class="s10"></td>
<td class="s58" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R36" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">37</div></th>
<td class="s27"></td>
<td class="s33"></td>
<td class="s33"></td>
<td class="s57" colspan="3"></td>
<td class="s33" colspan="3"></td>
<td class="s33" colspan="2"></td>
<td class="s57" colspan="2"></td>
<td class="s33" colspan="2"></td>
<td class="s57"></td>
<td class="s33"></td>
<td class="s54" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R37" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">38</div></th>
<td class="s27"></td>
<td class="s35"></td>
<td class="s28" colspan="4">項　目</td>
<td class="s28" colspan="3">〇　<span style="font-size:11pt;font-family:'Segoe UI Symbol',Arial;color:#000">✕</span></td>
<td class="s36"></td>
<td class="s37"></td>
<td class="s37"></td>
<td class="s38"></td>
<td class="s38"></td>
<td class="s37"></td>
<td class="s37"></td>
<td class="s37"></td>
<td class="s37"></td>
<td class="s37"></td>
<td class="s39"></td>
</tr>
<tr style="height:23px">
<th id="942883767R38" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">39</div></th>
<td class="s27"></td>
<td class="s28">1</td>
<td class="s35" colspan="4">外見確認</td>
<td class="s28" dir="ltr" colspan="3"></td>
<td class="s36" dir="ltr"></td>
<td></td>
<td></td>
<td class="s40"></td>
<td class="s40"></td>
<td></td>
<td></td>
<td class="s41"></td>
<td class="s41"></td>
<td class="s41"></td>
<td class="s42"></td>
</tr>
<tr style="height:23px">
<th id="942883767R39" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">40</div></th>
<td class="s27"></td>
<td class="s28">2</td>
<td class="s35" colspan="4">寸法測定</td>
<td class="s28" dir="ltr" colspan="3"></td>
<td class="s36" dir="ltr"></td>
<td></td>
<td class="s43"></td>
<td class="s10" colspan="2">最終検査員</td>
<td></td>
<td class="s43"></td>
<td class="s10">出荷検査</td>
<td class="s10">出荷承認</td>
<td class="s11" colspan="2">出荷者</td>
</tr>
<tr style="height:23px">
<th id="942883767R40" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">41</div></th>
<td class="s27"></td>
<td class="s28">3</td>
<td class="s35" colspan="4">幾何公差測定</td>
<td class="s28" colspan="3"></td>
<td class="s36"></td>
<td></td>
<td class="s43"></td>
<td class="s44" colspan="2"></td>
<td></td>
<td class="s43"></td>
<td class="s44"></td>
<td class="s44"></td>
<td class="s45" colspan="2"></td>
</tr>
<tr style="height:23px">
<th id="942883767R41" style="height:23px" class="row-headers-background"><div class="row-header-wrapper" style="line-height:23px">42</div></th>
<td class="s27"></td>
<td class="s46">4</td>
<td class="s47" dir="ltr" colspan="4">ミルシートと照合</td>
<td class="s48" dir="ltr" colspan="3"></td>
<td class="s49"></td>
<td class="s49"></td>
<td class="s51"></td>
<td class="s52" dir="ltr" colspan="2"></td>
<td class="s49"></td>
<td class="s51"></td>
<td class="s52"></td>
<td class="s52" dir="ltr"></td>
<td class="s53" colspan="2"></td>
</tr>
</tbody>
</table>
</div>
<script>
(function(){
  var tbody = document.querySelector('.waffle tbody');
  if(!tbody) return;

  var tds = tbody.querySelectorAll('td');
  tds.forEach(function(td){
    td.setAttribute('contenteditable','true');
    td.removeAttribute('aria-readonly');
  });

  var LABELS = [
    '様式-1','流動票','流　動　票','大和電機工業株式会社','発行日','特機事業所','Rev.H','依頼主','No.',
    '管理部門記入欄','会社名','製品名','図面番号','発送日','分納納期1','分納納期１','分納納期2','分納納期２',
    '材質','フライス','購入先','材料寸法','縦','横','高','個数','材料価格','新規/リピート','製造/設計/転売','外注価格',
    '業者1','業者２','業者2','業者3','業者4','役割','注文数','販売単価','作成者',
    '工程の注意点','図面問い合わせ内容：','図面問い合わせ内容','回答：','回答',
    '処理の有無','台待ち','いつ','誰が','誰に確認',
    '工程管理記入欄','特別購入品','月','日','工程記入','作業時間','段取時間(分)','治工具','冶工具','作業時間(分)',
    '外注又は加工者名','単価','品質確認者',
    '項目','項　目','〇　✕','外見確認','寸法測定','幾何公差測定','ミルシートと照合','最終検査員','出荷検査','出荷承認','出荷者'
  ];
  function norm(s){ return (s||'').replace(/\s+/g,'').trim(); }
  var labelSet = new Set(LABELS.map(norm));

  function lock(td){
    if(!td) return;
    td.setAttribute('contenteditable','false');
    td.setAttribute('aria-readonly','true');
    td.classList.add('readonly-cell');
    try{ td.blur(); }catch(e){}
  }

  tbody.querySelectorAll('td.s2, td.s9').forEach(function(td){
    if(td.classList.contains('s2') || td.textContent.trim() !== ''){
      lock(td);
    }
  });

  tds.forEach(function(td){
    var t = norm(td.textContent);
    if(labelSet.has(t)){
      lock(td);
    }
  });

  tds.forEach(function(td){
    var bg = window.getComputedStyle(td).backgroundColor || '';
    var bgNorm = bg.replace(/\s+/g,'').toLowerCase();
    if(bgNorm === 'rgb(217,217,217)' || bgNorm === 'rgba(217,217,217,1)'){
      lock(td);
    }
  });
})();
(function() {
  function formatISOToJPFull(iso) {
    if (!iso) return '';
    const parts = iso.split('-');
    if (parts.length !== 3) return iso;
    const [y, m, d] = parts;
    return `${y}年${m.padStart(2,'0')}月${d.padStart(2,'0')}日`;
  }
  function formatISOToMMDD(iso) {
    if (!iso) return '';
    const parts = iso.split('-');
    if (parts.length !== 3) return iso;
    const m = parts[1].padStart(2,'0');
    const d = parts[2].padStart(2,'0');
    return `${m}/${d}`;
  }
  function splitISOToMMDD(iso) {
    if (!iso) return {month: '', day: ''};
    const parts = iso.split('-');
    if (parts.length !== 3) return {month: '', day: ''};
    return {
      month: parts[1].padStart(2,'0'),
      day:   parts[2].padStart(2,'0')
    };
  }

  let headerJson = {
    "基本情報": {
      "発行日": "",
      "依頼主": "",
      "流動票番号": ""
    },
    "管理部門記入欄": {
      "会社名": "",
      "製品名": "",
      "図面番号": "",
      "発送日": "",
      "分納期1": "",
      "分納期2": "",
      "材質": "",
      "フライス": "",
      "購入先": "",
      "材料寸法": {
        "縦": "",
        "横": "",
        "高さ": ""
      },
      "個数": 0,
      "新規受注品かリピート品か": "",
      "製造か設計か転売か": "",
      "注文数": 0,
      "作成者": "",
      "関与業者": [
        { "業者名": "", "役割": "" },
        { "業者名": "", "役割": "" }
      ],
      "材料価格": 0,
      "外注価格": 0,
      "工程の注意点": "",
      "図面問い合わせ内容": "",
      "解答": "",
      "販売単価": 0,
      "確認履歴": [
        { "いつ": "", "誰が": "", "誰に": "", "処理の有無": "" }
      ],
      "多台待ち": 0
    }
  };

  let detailJson = {
    "工程管理記入欄":{
      "流動票番号": "",
      "図面番号": "",
      "特別購入品": ["","","",""],
      "工程管理": [
        {
          "作業日": "",
          "工程": "",
          "作業時間": { "開始": "", "終了": "" },
          "段取時間(分)": 0,
          "治工具": "",
          "作業時間(分)": 0,
          "外注または加工者名": "",
          "単価": 0,
          "品質確認者": ""
        }
      ]
    },
    "調査項目": {
      "外観確認": "",
      "寸法判定": "",
      "幾何公差測定": "",
      "ミルシート照合": "",
      "最終検査員": "",
      "最終検査員の日付": "",
      "出荷調査": "",
      "出荷調査の日付": "",
      "出荷承認": "",
      "出荷承認の日付": "",
      "出荷者": "",
      "出荷者の日付": ""
    }
  };

  const tableBody = document.querySelector('.waffle tbody');
  if (!tableBody) return;
  const trs = Array.from(tableBody.querySelectorAll('tr'));
  const COLS = "ABCDEFGHIJKLMNOPQRST".split("");
  const maxCols = 20;
  const grid = [];
  const openSpans = Array(maxCols).fill(null);

  trs.forEach((tr, rIndex) => {
    const row = Array(maxCols).fill(null);
    for (let c = 0; c < maxCols; c++) {
      if (openSpans[c]) {
        row[c] = openSpans[c].cell;
        openSpans[c].rowsLeft--;
        if (openSpans[c].rowsLeft === 0) {
          openSpans[c] = null;
        }
      }
    }
    const cells = Array.from(tr.children).filter((el, idx) => !(idx === 0 && el.tagName === 'TH'));
    let col = 0;
    cells.forEach(td => {
      while (col < maxCols && row[col] !== null) col++;
      const colspan = parseInt(td.getAttribute('colspan') || '1', 10);
      const rowspan = parseInt(td.getAttribute('rowspan') || '1', 10);
      const cellObj = { el: td, r: rIndex + 1, c: col };
      for (let c = col; c < col + colspan && c < maxCols; c++) {
        row[c] = cellObj;
        if (rowspan > 1) {
          openSpans[c] = { rowsLeft: rowspan - 1, cell: cellObj };
        }
      }
      col += colspan;
    });
    grid.push(row);
  });

function getTdByRC(rowNumber, colLetter) {
  const colIndex = COLS.indexOf(colLetter.toUpperCase());
  if (rowNumber < 1 || colIndex === -1) return null;
  const row = grid[rowNumber - 1];
  const cellObj = row && row[colIndex];
  return cellObj && cellObj.el ? cellObj.el : null;
}

function lockTd(rowNumber, colLetter) {
  const td = getTdByRC(rowNumber, colLetter);
  if (!td) return;
  td.setAttribute('contenteditable','false');
  td.setAttribute('aria-readonly','true');
  td.classList.add('readonly-cell');
}

function parseA1(a1){
  const m = String(a1).match(/^([A-T])(\d{1,3})$/i);
  if(!m) return null;
  return { col: m[1].toUpperCase(), row: parseInt(m[2],10) };
}

function lockRange(a1Start, a1End){
  const s = parseA1(a1Start);
  const e = parseA1(a1End || a1Start);
  if(!s || !e) return;

  const cStart = Math.min(COLS.indexOf(s.col), COLS.indexOf(e.col));
  const cEnd   = Math.max(COLS.indexOf(s.col), COLS.indexOf(e.col));
  const rStart = Math.min(s.row, e.row);
  const rEnd   = Math.max(s.row, e.row);

  for(let r=rStart; r<=rEnd; r++){
    for(let c=cStart; c<=cEnd; c++){
      lockTd(r, COLS[c]);
    }
  }
}

const READONLY_ITEMS = [
  ["A2","A42"],
  ["A1","R1"],["C2","E2"],["F2","H2"],["F3","H3"],["C4","F4"],
  ["J38","T38"],["J39","T39"],["J40","L40"],["J41","L41"],["J42","L42"],["O40","P40"],["O41","P41"],["O42","P42"],
];

function applyReadOnlyItems(){
  READONLY_ITEMS.forEach(item=>{
    if(Array.isArray(item)) lockRange(item[0], item[1]);
    else lockRange(item);
  });
}
applyReadOnlyItems();

  function setCell(rowNumber, colLetter, value) {
    if (value === undefined || value === null) return;
    const colIndex = COLS.indexOf(colLetter);
    if (colIndex === -1) return;
    const row = grid[rowNumber - 1];
    if (!row) return;
    const cellObj = row[colIndex];
    if (!cellObj) return;
    const td = cellObj.el;
    td.textContent = value;
    td.setAttribute('contenteditable', 'true');
    td.removeAttribute('aria-readonly');
  }

function getCellValue(rowNumber, colLetter) {
  const colIndex = COLS.indexOf(colLetter.toUpperCase());
  if (colIndex === -1) return '';
  const row = grid[rowNumber - 1];
  if (!row) return '';
  const cellObj = row[colIndex];
  if (!cellObj || !cellObj.el) return '';
  return cellObj.el.textContent.trim();
}

  function fillFromJson(hJson, dJson) {
    const base = (hJson && hJson["基本情報"]) || {};
    const mgmt = (hJson && hJson["管理部門記入欄"]) || {};

    setCell(3, 'C', formatISOToJPFull(base["発行日"]));
    setCell(4, 'J', base["依頼主"]);
    setCell(4, 'Q', base["流動票番号"]);

    setCell(6, 'C', mgmt["会社名"]);
    setCell(6, 'I', mgmt["製品名"]);
    setCell(6, 'O', mgmt["図面番号"]);
    setCell(6, 'R', formatISOToMMDD(mgmt["発送日"]));

    setCell(7, 'E', formatISOToMMDD(mgmt["分納期1"] || mgmt["分納納期１"]));
    setCell(7, 'G', formatISOToMMDD(mgmt["分納期1_2"] || ""));
    setCell(7, 'L', formatISOToMMDD(mgmt["分納期2"] || mgmt["分納納期２"]));
    setCell(7, 'N', formatISOToMMDD(mgmt["分納期2_2"] || ""));

    setCell(8, 'E', mgmt["材質"]);
    setCell(8, 'L', mgmt["フライス"]);
    setCell(8, 'P', mgmt["購入先"]);

    if (mgmt["材料寸法"]) {
      setCell(9, 'F', mgmt["材料寸法"]["縦"]);
      setCell(9, 'J', mgmt["材料寸法"]["横"]);
      setCell(9, 'M', mgmt["材料寸法"]["高さ"] || mgmt["材料寸法"]["高"]);
    }

    setCell(10, 'P', mgmt["個数"]);
    setCell(9, 'R', mgmt["材料価格"]);

    setCell(10, 'F', mgmt["新規受注品かリピート品か"] || mgmt["新規/リピート"]);
    setCell(10, 'L', mgmt["製造か設計か転売か"] || mgmt["製造/設計/転売"]);
    setCell(10, 'R', mgmt["外注価格"]);

    if (Array.isArray(mgmt["関与業者"])) {
      const g1 = mgmt["関与業者"][0];
      const g2 = mgmt["関与業者"][1];
      if (g1) {
        setCell(11, 'E', g1["業者名"]);
        setCell(11, 'K', g1["役割"]);
      }
      if (g2) {
        setCell(12, 'E', g2["業者名"]);
        setCell(12, 'K', g2["役割"]);
      }
    }

    setCell(11, 'R', mgmt["販売単価"]);
    setCell(12, 'P', mgmt["注文数"]);
    setCell(12, 'R', mgmt["作成者"]);
    const colIndexR = "ABCDEFGHIJKLMNOPQRST".indexOf('R');
    const cellCreator = grid[12 - 1][colIndexR];
    if (cellCreator && cellCreator.el) {
      cellCreator.el.classList.add('wrap-cell');
    }

    setCell(16, 'C', mgmt["工程の注意点"]);
    const colIndexC = "ABCDEFGHIJKLMNOPQRST".indexOf('C');
    const cellNote = grid[16 - 1][colIndexC];
    if (cellNote && cellNote.el) {
      cellNote.el.classList.add('wrap-cell');
    }

    setCell(18, 'G', mgmt["図面問い合わせ内容"]);
    setCell(19, 'G', mgmt["解答"] || mgmt["回答"]);

    const hist = Array.isArray(mgmt["確認履歴"]) ? mgmt["確認履歴"][0] : null;
    if (hist) {
      setCell(20, 'E', hist["処理の有無"]);
      setCell(20, 'J', formatISOToMMDD(hist["いつ"]));
      setCell(20, 'M', hist["誰が"]);
      setCell(20, 'Q', hist["誰に"]);
    }
    if (mgmt["多台待ち"] !== undefined) {
      setCell(20, 'G', mgmt["多台待ち"]);
    }

    const proc = (dJson && dJson["工程管理記入欄"]) || {};
    const insp = (dJson && dJson["調査項目"]) || {};

    const spItems = Array.isArray(proc["特別購入品"]) ? proc["特別購入品"] : [];
    const spStartRow = 21;
    const spStartColIndex = COLS.indexOf('H');
    spItems.forEach((item, idx) => {
      const row = spStartRow + Math.floor(idx / 7);
      const col = COLS[spStartColIndex + (idx % 7)];
      setCell(row, col, item);
    });

    const jobs = Array.isArray(proc["工程管理"]) ? proc["工程管理"] : [];
    const JOB_START_ROW = 24;
    jobs.forEach((job, i) => {
      const row = JOB_START_ROW + i;
      if (row > 35) return;
      let month = "", day = "";
      if (job["作業日"]) {
        const md = splitISOToMMDD(job["作業日"]);
        month = md.month;
        day = md.day;
      }
      setCell(row, 'C', month);
      setCell(row, 'D', day);
      setCell(row, 'E', job["工程"]);
      let workTime = "";
      if (job["作業時間"] && job["作業時間"]["開始"] && job["作業時間"]["終了"]) {
        workTime = job["作業時間"]["開始"] + "～" + job["作業時間"]["終了"];
      }
      setCell(row, 'H', workTime);
      setCell(row, 'K', job["段取時間(分)"]);
      setCell(row, 'M', job["治工具"]);
      setCell(row, 'O', job["作業時間(分)"]);
      setCell(row, 'Q', job["外注または加工者名"] || job["外注又は加工者名"]);
      setCell(row, 'R', job["単価"]);
      setCell(row, 'S', job["品質確認者"]);
    });

    setCell(39, 'G', insp["外観確認"] || insp["外見確認"]);
    setCell(40, 'G', insp["寸法判定"] || insp["寸法測定"]);
    setCell(41, 'G', insp["幾何公差測定"]);
    setCell(42, 'G', insp["ミルシート照合"] || insp["ミルシートと照合"]);

    setCell(41, 'M', formatISOToMMDD(insp["最終検査員の日付"]));
    setCell(42, 'M', insp["最終検査員"]);

    setCell(41, 'Q', formatISOToMMDD(insp["出荷調査の日付"]));
    setCell(42, 'Q', insp["出荷調査"]);

    setCell(41, 'R', formatISOToMMDD(insp["出荷承認の日付"]));
    setCell(42, 'R', insp["出荷承認"]);

    setCell(41, 'S', formatISOToMMDD(insp["出荷者の日付"]));
    setCell(42, 'S', insp["出荷者"]);
  }

function rebuildJsonFromTable() {
  const newHeader = JSON.parse(JSON.stringify(headerJson));
  const newDetail = JSON.parse(JSON.stringify(detailJson));

  newHeader["基本情報"] = newHeader["基本情報"] || {};
  newHeader["基本情報"]["発行日"]     = getCellValue(3, 'C');
  newHeader["基本情報"]["依頼主"]     = getCellValue(4, 'J');
  newHeader["基本情報"]["流動票番号"] = getCellValue(4, 'Q');

  const mgmt = newHeader["管理部門記入欄"] || {};
  mgmt["会社名"]              = getCellValue(6, 'C');
  mgmt["製品名"]              = getCellValue(6, 'I');
  mgmt["図面番号"]            = getCellValue(6, 'O');
  mgmt["発送日"]              = getCellValue(6, 'R');
  const dn1Left  = getCellValue(7, 'E');
  const dn1Right = getCellValue(7, 'G');
  mgmt["分納期1"]   = dn1Left;
  mgmt["分納期1_2"] = dn1Right;
  mgmt["分納納期１"] = dn1Left;

  const dn2Left  = getCellValue(7, 'L');
  const dn2Right = getCellValue(7, 'N');
  mgmt["分納期2"]   = dn2Left;
  mgmt["分納期2_2"] = dn2Right;
  mgmt["分納納期２"] = dn2Left;

  mgmt["材質"]                = getCellValue(8, 'E');
  mgmt["フライス"]            = getCellValue(8, 'L');
  mgmt["購入先"]              = getCellValue(8, 'P');
  mgmt["材料寸法"] = {
    "縦":   getCellValue(9, 'F'),
    "横":   getCellValue(9, 'J'),
    "高さ": getCellValue(9, 'M')
  };
  mgmt["個数"]                = getCellValue(10, 'P');
  mgmt["材料価格"]            = getCellValue(9, 'R');
  mgmt["新規/リピート"]       = getCellValue(10, 'F');
  mgmt["製造/設計/転売"]      = getCellValue(10, 'L');
  mgmt["新規受注品かリピート品か"] = mgmt["新規/リピート"];
  mgmt["製造か設計か転売か"]       = mgmt["製造/設計/転売"];
  mgmt["関与業者"] = [
    { "業者名": getCellValue(11, 'E'), "役割": getCellValue(11, 'K') },
    { "業者名": getCellValue(12, 'E'), "役割": getCellValue(12, 'K') },
    { "業者名": getCellValue(13, 'E'), "役割": getCellValue(13, 'K') },
    { "業者名": getCellValue(14, 'E'), "役割": getCellValue(14, 'K') }
  ];

  mgmt["外注価格"]            = getCellValue(10, 'R');
  mgmt["注文数"]              = getCellValue(12, 'P');
  mgmt["販売単価"]            = getCellValue(11, 'R');
  mgmt["作成者"]              = getCellValue(12, 'R');
  mgmt["工程の注意点"]        = getCellValue(16, 'C');
  mgmt["図面問い合わせ内容"]  = getCellValue(18, 'G');
  mgmt["解答"]                = getCellValue(19, 'G');

  mgmt["確認履歴"] = [{
    "処理の有無": getCellValue(20, 'E'),
    "いつ":       getCellValue(20, 'J'),
    "誰が":       getCellValue(20, 'M'),
    "誰に":       getCellValue(20, 'Q')
  }];
  mgmt["多台待ち"] = getCellValue(20, 'G');

  newHeader["管理部門記入欄"] = mgmt;

  const proc = newDetail["工程管理記入欄"] || {};
  const rows = [];
  for (let r = 24; r <= 35; r++) {
    const month = getCellValue(r, 'C');
    const day   = getCellValue(r, 'D');
    const kou   = getCellValue(r, 'E');
    const time  = getCellValue(r, 'H');
    const setup = getCellValue(r, 'K');
    const jig   = getCellValue(r, 'M');
    const workm = getCellValue(r, 'O');
    const worker= getCellValue(r, 'Q');
    const price = getCellValue(r, 'R');
    const qc    = getCellValue(r, 'S');

    if (!(month || day || kou || time || setup || jig || workm || worker || price || qc)) {
      continue;
    }

    rows.push({
      "作業日": month && day ? `-----${month}-${day}` : "",
      "工程": kou,
      "作業時間": {
        "開始": time.split('～')[0] || "",
        "終了": time.split('～')[1] || ""
      },
      "段取時間(分)": setup,
      "治工具": jig,
      "作業時間(分)": workm,
      "外注または加工者名": worker,
      "単価": price,
      "品質確認者": qc
    });
  }
  proc["工程管理"] = rows;
  newDetail["工程管理記入欄"] = proc;

  const insp = newDetail["調査項目"] || {};
  insp["外観確認"]           = getCellValue(39, 'G');
  insp["寸法判定"]           = getCellValue(40, 'G');
  insp["幾何公差測定"]       = getCellValue(41, 'G');
  insp["ミルシート照合"]     = getCellValue(42, 'G');
  insp["最終検査員の日付"]   = getCellValue(41, 'M');
  insp["最終検査員"]         = getCellValue(42, 'M');
  insp["出荷調査の日付"]     = getCellValue(41, 'Q');
  insp["出荷調査"]           = getCellValue(42, 'Q');
  insp["出荷承認の日付"]     = getCellValue(41, 'R');
  insp["出荷承認"]           = getCellValue(42, 'R');
  insp["出荷者の日付"]       = getCellValue(41, 'S');
  insp["出荷者"]             = getCellValue(42, 'S');
  newDetail["調査項目"] = insp;

  return { headerJson: newHeader, detailJson: newDetail };
}

  const applyBtn = document.getElementById('apply-json-btn');
  const jsonInput = document.getElementById('json-input');

if (tableBody && jsonInput) {
  tableBody.addEventListener('input', function() {
    const rebuilt = rebuildJsonFromTable();
    headerJson = rebuilt.headerJson;
    detailJson = rebuilt.detailJson;

    jsonInput.value =
      JSON.stringify(headerJson, null, 2) + "\n" +
      JSON.stringify(detailJson, null, 2);
  });
}

function extractJsonObjects(rawText) {
  const text = rawText
    .replace(/```json/gi, '')
    .replace(/```/g, '')
    .trim();

  const results = [];
  let buf = '';
  let depth = 0;
  let inString = false;
  let prev = '';

  for (let i = 0; i < text.length; i++) {
    const ch = text[i];
    buf += ch;

    if (ch === '"' && prev !== '\\') {
      inString = !inString;
    }

    if (!inString) {
      if (ch === '{') depth++;
      if (ch === '}') depth--;
    }

    if (depth === 0 && buf.trim()) {
      const candidate = buf.trim();
      if (candidate.startsWith('{') && candidate.endsWith('}')) {
        results.push(JSON.parse(candidate));
        buf = '';
      }
    }

    prev = ch;
  }

  const rest = buf.trim();
  if (rest) {
    results.push(JSON.parse(rest));
  }

  return results;
}
if (applyBtn && jsonInput) {
  applyBtn.addEventListener('click', function () {
    const text = jsonInput.value.trim();
    if (!text) return;

    try {
      const jsonList = extractJsonObjects(text);

      jsonList.forEach(obj => {
        if (obj.headerJson || obj.detailJson) {
          if (obj.headerJson) headerJson = obj.headerJson;
          if (obj.detailJson) detailJson = obj.detailJson;
          return;
        }

        if (obj["基本情報"] || obj["管理部門記入欄"]) {
          headerJson = obj;
          return;
        }

        if (obj["工程管理記入欄"] || obj["調査項目"]) {
          detailJson = obj;
          return;
        }
      });

      fillFromJson(headerJson, detailJson);
    } catch (e) {
      alert('JSONの形式が正しくありません: ' + e.message);
    }
  });
}
  const printBtn = document.getElementById('print-btn');
  if (printBtn) {
    printBtn.addEventListener('click', function() {
      window.print();
    });
  }

})();
</script>
